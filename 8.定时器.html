<html>
<head>
  <title>8.定时器</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/6.1.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="333"/>
<h1>8.定时器</h1>

<div>
<span><div><font style="font-family: 楷体; font-size: 14pt;"><b>1.普通定时器</b></font></div><div><ul><li><span style="font-family: 楷体; font-size: 14pt; line-height: 1.45;"><font color="#FF0000">SetTimer(number,周期,NULL);</font></span></li><li><span style="font-family: 楷体; font-size: 14pt; line-height: 1.45;"><font style="color: rgb(255, 0, 0);">类向导-&gt;消息-&gt;WM_TIMER  </font></span> <b style="font-family: 楷体; font-size: 14pt; line-height: 1.45;"> </b><br/></li></ul></div><div><font style="font-family: 楷体; font-size: 14pt;"><b>2.高精度多媒体定时器</b></font></div><div><font style="font-size: 14pt;"><span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 255);">    #include</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(163, 21, 21);">&quot;mmsystem.h&quot;</span></font></div><div><font style="font-size: 14pt;"><span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 255);"><span>    </span>#pragma</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 255);">comment</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">(</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 255);">lib</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">,</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(163, 21, 21);">&quot;winmm&quot;</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">)</span></font></div><div><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);"><font style="font-size: 14pt;"><br/></font></span></div><div><font style="font-size: 14pt;"><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">    </span><span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 255);">const</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 255);">int</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 128);">timePeriod</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">= 10;</span></font></div><div style="min-height: 11pt;"><font style="font-size: 14pt;"><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">    </span><span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 255);">const</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 255);">int</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 128);">timeRes</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">= 1 ;</span></font></div><div><font style="font-size: 14pt;"><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">    </span><span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 255);">UINT32</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 128);">timerID</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">= 0;</span></font></div><div><br/></div><div><font style="font-size: 14pt;">   <font style="font-family: 楷体;"> <span> <span>//创建定时器</span></span></font></font><br/></div><div><font style="font-size: 14pt; font-family: Consolas;"><span style="min-height: 11pt; font-family: Consolas; color: rgb(136, 0, 0);"><span>    </span>timeBeginPeriod</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">(</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 128);">timeRes</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">);</span></font></div><div><font style="font-size: 14pt;"><span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 128);"><span>    </span>timerID</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">=</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(136, 0, 0);">timeSetEvent</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">(</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 128);">timePeriod</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">,</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 128);">timeRes</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">,</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(136, 0, 0);">TimerHandler</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">,(</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 255);">DWORD</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">)</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 255);">this</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">,</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(160, 0, 160);">TIME_PERIODIC</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">);</span></font></div><div><font color="#FF0000" face="Consolas" style="font-size: 14pt;"><br/></font></div><div><span style="font-size: 14pt; font-family: 楷体;">   </span> <span style="font-size: 14pt; font-family: 楷体;">//关闭定时器</span></div><div><span style="font-family: 楷体;"><font style="font-size: 14pt;">    <span style="min-height: 11pt; font-family: Consolas; color: rgb(136, 0, 0);">timeKillEvent</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">(</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 128);">timerID</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">);</span></font></span></div><div><font style="font-size: 14pt;"><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">   </span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(136, 0, 0);">timeEndPeriod</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">(</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 128);">timeRes</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">);</span></font></div><div><br/></div><div><span style="font-size: 14pt; font-family: 楷体;">   </span> <span style="font-size: 14pt; font-family: 楷体;">//回调函数</span></div><div><font style="font-size: 14pt;"><span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 255);"><span>    </span>void</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(160, 0, 160);">CALLBACK</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(136, 0, 0);">TimerHandler</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">(</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 255);">UINT</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 128);">id</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">,</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 255);">UINT</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 128);">msg</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">,</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 255);">DWORD</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 128);">dwUser</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">,</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 255);">DWORD</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 128);">dw1</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">,</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 255);">DWORD</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 128);">dw2</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">)</span></font></div><div style="min-height: 11pt;"><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);"><font style="font-size: 14pt;"><span>    </span>{</font></span></div><div style="min-height: 11pt;"><font style="font-size: 14pt;"><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">    <span>    </span></span><span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 255);">CSimDemoDlg</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">*</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 128);">pThis</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">= (</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 255);">CSimDemoDlg</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">*)</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 128);">dwUser</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);">;</span></font><span style="color: rgb(1, 1, 1); font-family: Consolas; font-size: 14pt; line-height: 1.45;">  </span></div><div style="min-height: 11pt;"><span style="color: rgb(1, 1, 1); font-family: Consolas; font-size: 14pt; line-height: 1.45;">  </span></div><div><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);"><font style="font-size: 14pt;"><span>    </span>}</font></span></div><div><span style="min-height: 11pt; font-family: Consolas; color: rgb(1, 1, 1);"><font style="font-size: 14pt;"><br/></font></span></div><div><span style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14px; font-family: Arial;">    <span>    <span>    </span></span></span><font face="楷体" style="font-size: 14pt;">使用</font></span><font face="楷体" style="font-size: 14pt;"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: blue; background-color: rgb(204, 255, 255);">多媒体</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: red; background-color: rgb(255, 238, 238);">定时器</span><span style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">timeSetEvent()函数，该函数定时精度为ms级。利用该函数可以实现周期性的函数调用。函数的原型如下：</span><span style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </span></font></div><div><font face="楷体" style="font-size: 14pt;"><span style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">       MMRESULT timeSetEvent（ UINT uDelay,</span><span style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </span></font></div><div><font face="楷体" style="font-size: 14pt;"><span style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">                               UINT uResolution,</span><span style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </span></font></div><div><font face="楷体" style="font-size: 14pt;"><span style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">                               LPTIMECALLBACK lpTimeProc,</span><span style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </span></font></div><div><font face="楷体" style="font-size: 14pt;"><span style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">                               WORD dwUser,</span><span style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </span></font></div><div><span style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font face="楷体" style="font-size: 14pt;">                               UINT fuEvent ）</font></span></div><div><font face="楷体" style="font-size: 14pt;"><br style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/></font></div><div><span style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font face="楷体" style="font-size: 14pt;">  <span>    </span>该函数设置一个定时回调事件，此事件可以是一个一次性事件或周期性事件。事件一旦被激活，便调用指定的回调函数， 成功后返回事件的标识符代码，否则返回NULL。函数的参数说明如下：</font></span></div><div><span style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font face="楷体" style="font-size: 14pt;">       uDelay：以毫秒指定事件的周期。</font></span></div><div><font face="楷体" style="font-size: 14pt;"><span style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">       Uresolution：以毫秒指定延时的精度，数值越小</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: red; background-color: rgb(255, 238, 238);">定时器</span><span style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">事件分辨率越高。缺省值为1ms。</span></font></div><div><span style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font face="楷体" style="font-size: 14pt;">       LpTimeProc：指向一个回调函数。</font></span></div><div><span style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font face="楷体" style="font-size: 14pt;">       DwUser：存放用户提供的回调数据。</font></span></div><div><font face="楷体" style="font-size: 14pt;"><span style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">       FuEvent：指定</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: red; background-color: rgb(255, 238, 238);">定时器</span><span style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">事件类型：</span></font></div><div><span style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font face="楷体" style="font-size: 14pt;">       TIME_ONESHOT：uDelay毫秒后只产生一次事件</font></span></div><div><span style="color: rgb(51, 51, 51); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font face="楷体" style="font-size: 14pt;">       TIME_PERIODIC ：每隔uDelay毫秒周期性地产生事件。</font></span></div></span>
</div></body></html> 